# {{{ Paths
set alias_file       = ~/.config/mutt/alias
set header_cache     = ~/.config/mutt/cache/headers
set message_cachedir = ~/.config/mutt/cache/bodies
set certificate_file = ~/.config/mutt/certificates
set mailcap_path     = ~/.config/mutt/mailcap
set tmpdir           = ~/.cache/mutt
set signature        = ~/.config/mutt/sig
# }}}

# {{{ Crypto
set pgp_default_key = "0x603A83CA"
set crypt_autopgp = yes
set crypt_autosign = yes
# }}}

# {{{ Attachment handling
auto_view application/msword
auto_view application/pdf
auto_view application/vnd.openxmlformats-officedocument.wordprocessingml.document
auto_view application/x-zip-compressed
auto_view application/zip
auto_view audio/*
auto_view image/*
auto_view text/*
auto_view video/*
alternative_order text/enriched text/plain text/html
# }}}

# {{{ Basic configuraion
set realname = "Brian Clemens"
alternates brian@tiuxo.com
set wait_key = no
set timeout = 30        # time to wait for user input before aborting
set mail_check = 60     # check for mail every 60 seconds
# set delete              # don't ask bfore purging deleted messages
unset confirmappend     # don't ask before appending
set quit                # don't ask before quitting
unset mark_old          # don't bother marking mail as being seen only in the index
set pipe_decode         # strip headers and eval mimes when piping
set thorough_search     # strip headers and eval mimes before searching
set mail_check_stats    # collect stats for counts
set auto_tag = yes      # automatically apply actions to all tagged items
# }}}

# {{{ Sidebar
set sidebar_visible = yes

# Nice folder display, even though I don't use folders
set sidebar_folder_indent
set sidebar_short_path
set sidebar_indent_string="…"

set sidebar_format = "%B%?F? [%F]?%* %?N?%N/?%S" # <$name>[$flagged] $unread/$size
set sidebar_width   = 18

bind index,pager H  sidebar-toggle-visible
bind index,pager J  sidebar-next
bind index,pager K  sidebar-prev
bind index,pager L  sidebar-open
# }}}

# {{{ Status Bar
set status_chars  = " *%A"
set status_format = "   %f    %?n?%n/?%m %?d?   %d ?%?t?   %t ? %> %?p?   %p ?"
push <show-version>
# }}}

# View
set menu_scroll
set date_format = "%m/%d"


# Index
set index_format = "%D %-20.20F %?M?[+%M] ?%s %g"
set sort = threads
set sort_aux = reverse-last-date-received
set uncollapse_jump         # don't collapse on an unread message
set sort_re                 # thread based on regex
set reply_regexp = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"

macro index \\\\ "<vfolder-from-query>" "Search mailbox"
bind index,pager \` modify-labels
macro index A "<modify-labels>+archive -inbox\n" "Archive message"
macro index I "<modify-labels>-archive +inbox\n" "Unarchive message"
macro index c "<change-vfolder>?" "Change to vfolder overview"
bind index g        noop
bind index gg       first-entry
bind index G        last-entry
bind index R        group-reply
bind index <tab>    sync-mailbox
bind index <space>  collapse-thread
macro index \Cr "T~U<enter><tag-prefix><clear-flag>N<untag-pattern>.<enter>" "mark all messages as read"
macro index o "<shell-escape>offlineimap -o -u basic &<enter>" "synchronize mail"


# Pager
set tilde
unset markers
set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
set pager_index_lines = 10 # number of index lines to show
set pager_context = 3      # number of context lines to show
set pager_stop             # don't go to next message automatically

bind pager k  previous-line
bind pager j  next-line
bind pager g noop
bind pager gg top
bind pager G  bottom
bind pager R  group-reply
macro pager T "<pipe-message>tail -n +6 | .zplugin/plugins/soimort---translate-shell/translate | less -+S<enter>"

# Attachments
bind attach <return> view-mailcap
macro pager T "<pipe-entry>.zplugin/plugins/soimort---translate-shell/translate | less -+S<enter>"
macro attach V "<pipe-entry>cat >~/.cache/mail.html && qutebrowser ~/.cache/mail.html && rm ~/.cache/mail.html<enter>"

# Headers
ignore
unignore from: to: cc: date: subject:
unignore organization: organisation: \
    user-agent: x-mailer: x-newsreader: \
    x-mailing-list:
unignore posted-to:
unhdr_order *
hdr_order from: to: cc: date: subject:

# Sending mail
set edit_headers = yes
set sendmail = "/usr/bin/msmtp --read-envelope-from"
# set sendmail = "~/bin/msmtp-enqueue.sh --read-envelope-from"

# Account settings
set folder = ~/Mail/brian-tiuxo.com
set record = +Sent
set postponed = +Drafts
set from = "brian@tiuxo.com"


# Default inbox.
set virtual_spoolfile=yes
set nm_default_uri = "notmuch:///home/brian/Mail"

# Mailboxes
virtual-mailboxes "inbox" "notmuch://?query=tag:inbox"
virtual-mailboxes " debian" "notmuch://?query=tag:debian"
virtual-mailboxes " dev" "notmuch://?query=tag:dev OR tag:bugs"
virtual-mailboxes " family" "notmuch://?query=tag:family"
virtual-mailboxes " lobsters" "notmuch://?query=tag:lobsters"
virtual-mailboxes " tlug" "notmuch://?query=tag:tlug"
virtual-mailboxes " work" "notmuch://?query=tag:work"
virtual-mailboxes "archive" "notmuch://?query=tag:archive"
virtual-mailboxes "draft" "notmuch://?query=tag:draft"
virtual-mailboxes "sent" "notmuch://?query=tag:sent"
virtual-mailboxes "spam" "notmuch://?query=tag:spam"
virtual-mailboxes "trash" "notmuch://?query=tag:trash"

# set vfolder_format = "%C %n/%m %f"

tag-transforms \
    "archive"   " " \
    "bugs"   	" " \
    "debian"    " " \
    "dev"       " " \
    "family"    " " \
    "inbox"     "​" \
    "list"      " " \
    "lobsters"  " " \
    "replied"   " " \
    "sent"      " " \
    "spam"      " " \
    "tlug"      " " \
    "work"      " " \
    "trash"     " " \
    "unread"    " " \

# {{{ Colors
color normal        default         default
color error         color124        default
color tilde         color235        default
color message       color106        default
color markers       color246        default
color attachment    color4          default
color search        color235        color172
color status        color246        color237
color indicator     color248        color239
color tree          default         default

mono  bold          bold
mono  underline     underline
mono  indicator     reverse
mono  error         bold

# index ----------------------------------------------------------------
color index     color246    default     "~R"            # read
color index     default     default     "~U"            # unread
color index     red         default     "~D"            # deleted
color index     color246    default     "~v~(!~N)"      # collapsed thread with no unread
color index     default     default     "~v~(~N)"       # collapsed thread with some unread
color index     color132    default     "~v~(~F)"       # collapsed thread with flagged
color index     color132    default     "~F"            # flagged
color index     default     blue        "~T"            # tagged
color index_tags        color172    default     # message tags
color index_collapsed   color106    default     # collapsed thread count

# message headers ------------------------------------------------------

color hdrdefault    color246        default
color header        color250        default     "^(From)"
color header        color229        default     "^(Subject)"

# body -----------------------------------------------------------------

color quoted        color106        default
color quoted1       color132        default
color quoted2       color72         default
color quoted3       color172        default
color quoted4       color124        default

color signature     color248        default
# color bold          color223        default
# color underline     color250        default
# color normal        color250        default

## pgp
color body          green       default     "^gpg: Good signature .*"
color body          color172    default     "^gpg: "
color body          red         color160    "^gpg: BAD signature from.*"
mono  body          bold                    "^gpg: Good signature"
mono  body          bold                    "^gpg: BAD signature from.*"
# }}}
