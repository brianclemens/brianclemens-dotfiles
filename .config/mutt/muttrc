# {{{ Paths
set alias_file       = ~/.config/mutt/alias
set header_cache     = ~/.config/mutt/cache/headers
set message_cachedir = ~/.config/mutt/cache/bodies
set certificate_file = ~/.config/mutt/certificates
set mailcap_path     = ~/.config/mutt/mailcap
set tmpdir           = ~/.cache/mutt
set signature        = ~/.config/mutt/sig
# }}}

# {{{ Crypto
set pgp_default_key = "0x603A83CA"
set crypt_autopgp = yes
set crypt_autosign = yes
# }}}

# {{{ Attachment handling
auto_view application/msword
auto_view application/pdf
auto_view application/vnd.openxmlformats-officedocument.wordprocessingml.document
auto_view application/x-zip-compressed
auto_view application/zip
auto_view audio/*
auto_view image/*
auto_view text/*
auto_view video/*
alternative_order text/enriched text/plain text/html
# }}}

# {{{ Basic configuraion
set realname = "Brian Clemens"
alternates brian@tiuxo.com
set wait_key = no
set timeout = 30        # time to wait for user input before aborting
set mail_check = 60     # check for mail every 60 seconds
# set delete              # don't ask bfore purging deleted messages
unset confirmappend     # don't ask before appending
set quit                # don't ask before quitting
unset mark_old          # don't bother marking mail as being seen only in the index
set pipe_decode         # strip headers and eval mimes when piping
set thorough_search     # strip headers and eval mimes before searching
set mail_check_stats    # collect stats for counts
set auto_tag = yes      # automatically apply actions to all tagged items
# }}}

# {{{ Sidebar
set sidebar_visible = yes

# Nice folder display, even though I don't use folders
set sidebar_folder_indent
set sidebar_short_path
set sidebar_indent_string="…"

set sidebar_format = "%B%?F? [%F]?%* %?N?%N/?%S" # <$name>[$flagged] $unread/$size
set sidebar_width   = 18

bind index,pager H  sidebar-toggle-visible
bind index,pager J  sidebar-next
bind index,pager K  sidebar-prev
bind index,pager L  sidebar-open
# }}}

# {{{ Status Bar
set status_chars  = " *%A"
set status_format = "   %f    %?n?%n/?%m %?d?   %d ?%?t?   %t ? %> %?p?   %p ?"
push <show-version>
# }}}

# Index View Options
set pager_index_lines = 10 # number of index lines to show
set pager_context = 3      # number of context lines to show
set pager_stop             # don't go to next message automatically
set menu_scroll            # scroll in menus
set tilde                  # show tildes like in vim
unset markers              # no ugly plus signs
set quote_regexp = "^( {0,4}[>|:#%]| {0,4}[a-z0-9]+[>|]+)+"
set date_format = "%m/%d"
# set index_format = "[%Z] %D %-20.20F %s %g"
set index_format = "%D %-20.20F %s %g"
set sort = threads
set sort_aux = reverse-last-date-received
set uncollapse_jump         # don't collapse on an unread message
set sort_re                 # thread based on regex
set reply_regexp = "^(([Rr][Ee]?(\[[0-9]+\])?: *)?(\[[^]]+\] *)?)*"

# Pager Key Bindings
bind pager k  previous-line
bind pager j  next-line
bind pager g noop
bind pager gg top
bind pager G  bottom

bind pager R  group-reply

# View attachments properly.
bind attach <return> view-mailcap

# Header Options
ignore
unignore from: to: cc: date: subject:
unignore organization: organisation: \
    user-agent: x-mailer: x-newsreader: \
    x-mailing-list:
unignore posted-to:
unhdr_order *
hdr_order from: to: cc: date: subject:

# Sending mail
set edit_headers = yes
set sendmail = "~/bin/msmtp-enqueue.sh --read-envelope-from"

# Account settings
set folder = ~/Mail/brian-tiuxo.com
set record = +Sent
set postponed = +Drafts
set from = "brian@tiuxo.com"


# Default inbox.
set virtual_spoolfile=yes
set nm_default_uri = "notmuch:///home/brian/Mail"

# Mailboxes
virtual-mailboxes "inbox" "notmuch://?query=tag:inbox"
virtual-mailboxes "bugs" "notmuch://?query=tag:bugs"
virtual-mailboxes "debian" "notmuch://?query=tag:debian"
virtual-mailboxes "family" "notmuch://?query=tag:family"
virtual-mailboxes "archive" "notmuch://?query=tag:archive"
virtual-mailboxes "draft" "notmuch://?query=tag:draft"
virtual-mailboxes "sent" "notmuch://?query=tag:sent"
virtual-mailboxes "spam" "notmuch://?query=tag:spam"
virtual-mailboxes "trash" "notmuch://?query=tag:trash"

# set vfolder_format = "%C %n/%m %f"

# Index Key Bindings ---------------------------------
macro index \\\\ "<vfolder-from-query>" "Search mailbox"
bind index,pager \` modify-labels
macro index A "<modify-labels>+archive -unread -inbox\n" "Archive message"
macro index I "<modify-labels>-archive +inbox\n" "Unarchive message"
macro index c "<change-vfolder>?" "Change to vfolder overview"

bind index g        noop
bind index gg       first-entry
bind index G        last-entry

bind index R        group-reply
bind index <tab>    sync-mailbox
bind index <space>  collapse-thread

# Ctrl-R to mark all as read
macro index \Cr "T~U<enter><tag-prefix><clear-flag>N<untag-pattern>.<enter>" "mark all messages as read"

# Sync email
macro index o "<shell-escape>mbsync -a -q &<enter>" "synchronize mail"

# Open message in qutebrowser
macro attach 'V' "<pipe-entry>cat >~/.cache/mail.html && qutebrowser ~/.cache/mail.html && rm ~/.cache/fmail.html<enter>"

tag-transforms \
    "archive"   " " \
    "inbox"     "​" \
    "debian"    "" \
    "list"      " " \
    "replied"   " " \
    "sent"      " " \
    "spam"      " " \
    "tlug"      " " \
    "trash"     " " \
    "unread"    " " \

# {{{ Colors
color normal        default         default
color error         color124        default
color tilde         color235        default
color message       color106        default
color markers       color246        default
color attachment    color4          default
color search        color235        color172
color status        color246        color237
color indicator     color248        color239
color tree          default         default

mono  bold          bold
mono  underline     underline
mono  indicator     reverse
mono  error         bold

# index ----------------------------------------------------------------
#color index         color160        default        "~D(!~p|~p)"               # deleted
#color index         color235        default        ~F                         # flagged
#color index         color166        default        ~=                         # duplicate messages
#color index         color240        default        "~A!~N!~T!~p!~Q!~F!~D!~P"  # the rest
#color index         J_base          default        "~A~N!~T!~p!~Q!~F!~D"      # the rest, new
# color index         color223        default        "~A"                        # all messages
# color index         color124        default        "~E"                        # expired messages
# color index         color229        default        "~N"                        # new messages
# color index         color246        default        "~O"                        # old messages
# color index         color100        default        "~Q"                        # messages that have been replied to
# color index         color246        default        "~R"                        # read messages
# color index         color229        default        "~U"                        # unread messages
# color index         color229        default        "~U~$"                      # unread, unreferenced messages
# color index         color246        default        "~v"                        # messages part of a collapsed thread
# color index         color132        default        "~P"                        # messages from me
# color index         color223        default        "~p!~F"                     # messages to me
# color index         color229        default        "~N~p!~F"                   # new messages to me
# color index         color229        default        "~U~p!~F"                   # unread messages to me
# color index         color229        default        "~R~p!~F"                   # messages to me
# color index         color166        default        "~F"                        # flagged messages
# color index         color166        default        "~F~p"                      # flagged messages to me
# color index         color166        default        "~N~F"                      # new flagged messages
# color index         color166        default        "~N~F~p"                    # new flagged messages to me
# color index         color166        default        "~U~F~p"                    # new flagged messages to me
# color index         color88         default        "~D"                        # deleted messages
# color index         color246        default        "~v~(!~N)"                  # collapsed thread with no unread
# color index         color229        default        "~v~(~N)"                   # collapsed thread with some unread
# color index         color250        default        "~N~v~(~N)"                 # collapsed thread with unread parent
# color index         color166        default         "~v~(~F)!~N"                # collapsed thread with flagged, no unread
# color index         color166        default         "~v~(~F~N)"                 # collapsed thread with some unread & flagged
# color index         color166        default         "~N~v~(~F~N)"               # collapsed thread with unread parent & flagged
# color index         color166        default         "~N~v~(~F)"                 # collapsed thread with unread parent, no unread inside, but some flagged
# color index         color229        default         "~v~(~p)"                   # collapsed thread with unread parent, no unread inside, some to me directly
# color index         color88         default         "~v~(~D)"                   # thread with deleted (doesn't differentiate between all or partial)
#color index         color136        default        "~(~N)"                    # messages in threads with some unread
#color index         color64         default        "~S"                       # superseded messages
#color index         color160        default        "~T"                       # tagged messages
#color index         color166        color160       "~="                       # duplicated messages

# message headers ------------------------------------------------------

color hdrdefault    color246         default
color header        color250         default        "^(From)"
color header        color229        default        "^(Subject)"

# body -----------------------------------------------------------------

color quoted        color106        default
color quoted1       color132        default
color quoted2       color72         default
color quoted3       color172        default
color quoted4       color124        default

color signature     color248        default
color bold          color223        default
color underline     color250        default
color normal        color250        default

## pgp
color body          color124        default        "(BAD signature)"
color body          color106        default        "(Good signature)"
color body          default         default        "^gpg: Good signature .*"
color body          color172        default        "^gpg: "
color body          color167        color160        "^gpg: BAD signature from.*"
mono  body          bold                            "^gpg: Good signature"
mono  body          bold                            "^gpg: BAD signature from.*"
# }}}
